<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ideal Weight & BMI Calculator</title>

  <!-- Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#FFF7F0;
      --bg2:#F3FAFF;
      --card:#FFFFFFCC;
      --text:#1F2937;
      --muted:#6B7280;
      --accent:#FF7A59;
      --shadow: 0 20px 60px rgba(31,41,55,.12);
      --radius: 24px;
      --line: rgba(31,41,55,.08);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(255,122,89,.18), transparent 55%),
        radial-gradient(900px 500px at 85% 20%, rgba(255,183,3,.18), transparent 50%),
        radial-gradient(900px 600px at 55% 90%, rgba(46,196,182,.14), transparent 50%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      padding:32px 16px;
    }
    .wrap{ max-width: 1020px; margin: 0 auto; }
    .header{ margin-bottom:18px; }
    .title{
      font-size: clamp(24px, 3vw, 34px);
      line-height: 1.15;
      margin:0;
      letter-spacing: -0.5px;
      font-weight: 800;
    }
    .subtitle{
      margin:10px 0 0 0;
      color:var(--muted);
      max-width: 70ch;
      font-size: 14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 18px;
      align-items: start;
    }
    @media (max-width: 920px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: var(--card);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.85);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-head{ padding: 18px 18px 0 18px; }
    .card-title{
      margin:0;
      font-size: 16px;
      font-weight: 800;
      letter-spacing: -.2px;
    }
    .card-note{
      margin:6px 0 0 0;
      color: var(--muted);
      font-size: 13px;
    }
    .card-body{ padding: 16px 18px 18px 18px; }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 520px){ .row{ grid-template-columns: 1fr; } }

    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom: 12px; }
    label{ font-size: 13px; color: var(--muted); }

    input, select{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(31,41,55,.10);
      background: rgba(255,255,255,.88);
      outline: none;
      font-size: 15px;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    input:focus, select:focus{
      border-color: rgba(255,122,89,.55);
      box-shadow: 0 0 0 4px rgba(255,122,89,.16);
    }

    .unitbox{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items:center;
    }
    .unit{
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(31,41,55,.10);
      background: rgba(255,255,255,.72);
      color: var(--muted);
      font-size: 14px;
      min-width: 62px;
      text-align:center;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    button{
      border:0;
      padding: 12px 14px;
      border-radius: 16px;
      font-weight: 800;
      cursor:pointer;
      font-size: 14px;
      transition: transform .06s ease, filter .12s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    button:active{ transform: translateY(1px); }
    .primary{
      color: white;
      background: linear-gradient(135deg, var(--accent), #FF9157);
      box-shadow: 0 12px 28px rgba(255,122,89,.25);
    }
    .ghost{
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(31,41,55,.10);
      color: var(--text);
    }

    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    .error{
      font-size: 12px;
      color: #B42318;
      margin-top: -2px;
      min-height: 16px;
    }

    .results{ padding: 18px; display:flex; flex-direction:column; gap:14px; }

    .big{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding: 16px 16px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(46,196,182,.16), rgba(255,183,3,.14));
      border: 1px solid rgba(255,255,255,.85);
    }
    .big .k{
      font-size: 12px;
      color: var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .big .v{
      font-size: clamp(22px, 3vw, 28px);
      font-weight: 900;
      letter-spacing:-.4px;
    }

    .item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 14px 14px;
      border-radius: 16px;
      background: rgba(255,255,255,.78);
      border: 1px solid var(--line);
    }
    .item .left{ display:flex; flex-direction:column; gap:2px; min-width:0; }
    .item .name{ font-weight: 900; font-size: 14px; line-height:1.2; }
    .item .desc{ font-size: 12px; color: var(--muted); }
    .item .val{ font-weight: 900; font-size: 14px; white-space: nowrap; }

    .bmi-card{
      padding: 16px 16px;
      border-radius: 20px;
      background: rgba(255,255,255,.78);
      border: 1px solid var(--line);
    }
    .bmi-top{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 8px;
    }
    .bmi-status{
      font-size: 22px;
      font-weight: 900;
      letter-spacing: -0.3px;
      margin: 2px 0 10px 0;
    }
    .bmi-bar{
      position: relative;
      height: 14px;
      border-radius: 999px;
      overflow:hidden;
      background: #eee;
      border: 1px solid rgba(31,41,55,.10);
    }
    .seg{ height:100%; float:left; }

    /* Asia-Pasifik visual scale 12..40:
       12–18.5 under | 18.5–22.9 normal | 22.9–24.9 overweight | 24.9–40 obese+ */
    .s1{ width: 23%; background: #ff4d4f; }
    .s2{ width: 15%; background: #91c55b; }
    .s3{ width: 7%;  background: #ffd166; }
    .s4{ width: 55%; background: #ff4d4f; }

    .marker{
      position:absolute;
      top: -18px;
      transform: translateX(-50%);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      pointer-events:none;
    }
    .marker .bubble{
      background:#111827;
      color:white;
      font-weight:900;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      line-height:1;
      box-shadow: 0 10px 20px rgba(17,24,39,.15);
    }
    .marker .tri{
      width:0;height:0;
      border-left:7px solid transparent;
      border-right:7px solid transparent;
      border-top:10px solid #111827;
    }
    .bmi-msg{
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.45;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.78);
      border:1px solid var(--line);
      color: var(--muted);
      font-size: 12px;
    }
    .warn{
      background: rgba(255,122,89,.10);
      border-color: rgba(255,122,89,.22);
      color: #8A2E1B;
    }
    .mono{ font-variant-numeric: tabular-nums; }

    .footer{
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1 class="title">Ideal Weight & BMI Calculator</h1>
      <p class="subtitle">
        Masukkan tinggi + berat untuk menghitung <b>BMI</b>, serta estimasi <b>berat ideal </b> dan rentang berat dari <b>BMI normal (Asia-Pasifik)</b>.
      </p>
    </div>

    <div class="grid">
      <!-- INPUT -->
      <section class="card" aria-label="Input">
        <div class="card-head">
          <p class="card-title">Masukkan data</p>
          <p class="card-note">Klik tombol <b>Hitung</b> untuk menampilkan hasil.</p>
        </div>

        <div class="card-body">
          <form id="calcForm" novalidate>
            <div class="row">
              <div class="field">
                <label for="age">Umur</label>
                <input id="age" type="text" inputmode="numeric" autocomplete="off" placeholder="Contoh: 21" />
              </div>

              <div class="field">
                <label for="gender">Gender</label>
                <select id="gender">
                  <option value="male">Pria</option>
                  <option value="female">Wanita</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="heightCm">Tinggi badan</label>
                <div class="unitbox">
                  <input id="heightCm" type="text" inputmode="numeric" autocomplete="off" placeholder="Contoh: 170" />
                  <div class="unit">cm</div>
                </div>
              </div>

              <div class="field">
                <label for="weightKg">Berat badan</label>
                <div class="unitbox">
                  <!-- decimal keyboard hint; validation handled by JS -->
                  <input id="weightKg" type="text" inputmode="decimal" autocomplete="off" placeholder="Contoh: 75 atau 60.8" />
                  <div class="unit">kg</div>
                </div>
                <div class="error" id="weightErr" aria-live="polite"></div>
              </div>
            </div>

            <div class="actions">
              <button class="primary" id="btnCalc" type="submit">✨ Hitung</button>
              <button class="ghost" id="btnReset" type="button">Reset</button>
            </div>

            <div class="hint">
              Tinggi & umur hanya angka. Berat boleh desimal dengan <b>titik</b> (contoh: <b>60.8</b>).
            </div>
          </form>
        </div>
      </section>

      <!-- RESULTS -->
      <section class="card" aria-label="Hasil">
        <div class="results">
          <div class="big">
            <div class="k">
              <span>Ringkasan (rentang BMI normal — Asia-Pasifik)</span>
              <span id="miniMeta" class="mono">—</span>
            </div>
            <div class="v mono" id="bmiRangeBig">—</div>
          </div>

          <div class="item">
            <div class="left">
              <div class="name">Berat badan ideal</div>
              <div class="desc">Estimasi berat badan ideal berbasis tinggi badan</div>
            </div>
            <div class="val mono" id="devineVal">—</div>
          </div>

          <div class="bmi-card" id="bmiCard">
            <div class="bmi-top">
              <span id="bmiTitle">BMI</span>
              <span class="mono" id="bmiMeta">—</span>
            </div>

            <div class="bmi-status" id="bmiStatus">—</div>

            <div class="bmi-bar" aria-label="BMI Bar">
              <div class="seg s1"></div>
              <div class="seg s2"></div>
              <div class="seg s3"></div>
              <div class="seg s4"></div>

              <div class="marker" id="bmiMarker" style="left:50%;">
                <div class="bubble mono" id="bmiValueBubble">—</div>
                <div class="tri"></div>
              </div>
            </div>

            <div class="bmi-msg" id="bmiMsg">—</div>
          </div>

          <div id="ageWarning" class="badge warn" style="display:none;">
            ⚠️ Untuk usia <b>&lt; 18</b>, interpretasi BMI biasanya berbeda (pakai kurva pertumbuhan).
          </div>

          <div class="footer">
            Catatan (Asia-Pasifik): <b>Normal</b> 18.5–22.9 • <b>Kelebihan BB</b> 23.0–24.9 • <b>Obesitas</b> ≥ 25.
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // Format numbers with DOT decimal (not comma), without thousand separators.
    // Examples: 60.8 -> "60.8", 60.0 -> "60"
    function fmt(n, decimals = 1){
      if (!Number.isFinite(n)) return "—";
      const s = n.toFixed(decimals);          // always uses dot
      // strip trailing zeros
      return s.replace(/\.0+$/,"").replace(/(\.\d*[1-9])0+$/,"$1");
    }
    const kgToStr = (kg) => `${fmt(kg, 1)} kg`;

    const clamp = (v, min, max) => Math.min(max, Math.max(min, v));
    const cmToIn = (cm) => cm / 2.54;

    // Devine (1974)
    function ibwDevine(gender, inches){
      const d = inches - 60;
      return gender === "male" ? (50 + 2.3 * d) : (45.5 + 2.3 * d);
    }

    // BMI NORMAL range (Asia-Pasifik): 18.5–22.9
    function bmiHealthyRangeKg(heightCm){
      const h = heightCm / 100;
      return { min: 18.5 * h * h, max: 22.9 * h * h };
    }

    function bmiValue(heightCm, weightKg){
      const h = heightCm / 100;
      return weightKg / (h * h);
    }

    // Asia-Pacific categories
    function bmiCategoryAsiaPacific(bmi){
      if (bmi < 18.5) return { label: "Kurus", msg: "Fokus tingkatkan asupan bergizi dan pola hidup sehat." };
      if (bmi < 23)   return { label: "Normal", msg: "Bagus! Pertahankan pola makan & aktivitas rutin." };
      if (bmi < 25)   return { label: "Kelebihan BB", msg: "Mulai rapikan pola makan dan tambah aktivitas harian." };
      if (bmi < 30)   return { label: "Obesitas", msg: "Utamakan hidup sehat dan perhatikan konsumsi harian." };
      return            { label: "Obesitas (Kelas II)", msg: "Pertimbangkan program terarah dan konsultasi tenaga kesehatan." };
    }

    // Marker position: map BMI 12..40 to 0..100 (visual only)
    function bmiToPercent(bmi){
      const min = 12, max = 40;
      const p = ((bmi - min) / (max - min)) * 100;
      return clamp(p, 0, 100);
    }

    // Digits only for integer inputs
    function digitsOnly(el){
      el.addEventListener("input", () => {
        const before = el.value;
        const after = before.replace(/\D+/g, "");
        if (before !== after) el.value = after;
        el.setCustomValidity("");
      });
    }

    // Decimal input for weight: allow digits + ONE dot, max 2 decimals; comma converted to dot
    function decimalDotOnly(el){
      el.addEventListener("input", () => {
        let v = el.value;

        // convert comma to dot for convenience
        v = v.replace(/,/g, ".");

        // keep digits and dots only
        v = v.replace(/[^\d.]/g, "");

        // keep only first dot
        const parts = v.split(".");
        if (parts.length > 2) {
          v = parts[0] + "." + parts.slice(1).join("");
        }

        // limit decimals to 2 (you can change to 1 if you want)
        const [a, b] = v.split(".");
        if (b !== undefined) v = a + "." + b.slice(0, 2);

        el.value = v;

        // clear errors while typing
        el.setCustomValidity("");
        const err = $("weightErr");
        if (err) err.textContent = "";
      });
    }

    const form = $("calcForm");
    const ageEl = $("age");
    const genderEl = $("gender");
    const heightEl = $("heightCm");
    const weightEl = $("weightKg");
    const weightErrEl = $("weightErr");

    digitsOnly(ageEl);
    digitsOnly(heightEl);
    decimalDotOnly(weightEl);

    // Defaults
    heightEl.value = "";
    weightEl.value = "";

    const bmiRangeBigEl = $("bmiRangeBig");
    const miniMetaEl = $("miniMeta");
    const devineValEl = $("devineVal");

    const bmiTitleEl = $("bmiTitle");
    const bmiMetaEl = $("bmiMeta");
    const bmiStatusEl = $("bmiStatus");
    const bmiMsgEl = $("bmiMsg");
    const bmiMarkerEl = $("bmiMarker");
    const bmiBubbleEl = $("bmiValueBubble");

    const warnEl = $("ageWarning");

    function setError(el, msg){
      el.setCustomValidity(msg);
      el.reportValidity();
    }

    function clearError(el){
      el.setCustomValidity("");
    }

    function readInt(el){
      const v = el.value.trim();
      if (!v) return NaN;
      const n = Number.parseInt(v, 10);
      return Number.isFinite(n) ? n : NaN;
    }

    function readWeight(el){
      const raw = el.value.trim();
      if (!raw) return { ok:false, value: NaN, raw };

      // Valid: "75", "60.8", "60.85" (dot only)
      // Invalid: "60.", ".8", "60..8"
      const re = /^\d+(\.\d{1,2})?$/;
      if (!re.test(raw)) return { ok:false, value: NaN, raw };

      const n = Number.parseFloat(raw);
      if (!Number.isFinite(n)) return { ok:false, value: NaN, raw };
      return { ok:true, value: n, raw };
    }

    function validate(){
      const h = readInt(heightEl);
      const wObj = readWeight(weightEl);
      const w = wObj.value;

      clearError(heightEl);
      clearError(weightEl);
      if (weightErrEl) weightErrEl.textContent = "";

      if (!Number.isFinite(h)) { setError(heightEl, "Masukkan tinggi badan (angka). Contoh: 170"); return null; }
      if (h < 120 || h > 220)  { setError(heightEl, "Tinggi badan harus 120–220 cm."); return null; }

      if (!wObj.ok) {
        const msg = "Berat badan harus angka. Desimal pakai titik (contoh: 60.8).";
        if (weightErrEl) weightErrEl.textContent = msg;
        setError(weightEl, msg);
        return null;
      }
      if (w < 20 || w > 300) {
        const msg = "Berat badan harus 20–300 kg.";
        if (weightErrEl) weightErrEl.textContent = msg;
        setError(weightEl, msg);
        return null;
      }

      return { heightCm: h, weightKg: w };
    }

    function calculate(){
      const gender = genderEl.value;
      const age = readInt(ageEl);

      const v = validate();
      if (!v) return;

      const { heightCm, weightKg } = v;

      // Summary meta (height integer)
      miniMetaEl.textContent = `${heightCm} cm • ${gender === "male" ? "Pria" : "Wanita"}`;

      // BMI normal range (Asia-Pasifik)
      const r = bmiHealthyRangeKg(heightCm);
      bmiRangeBigEl.textContent = `${kgToStr(r.min)} – ${kgToStr(r.max)}`;

      // Devine
      const inches = cmToIn(heightCm);
      const dev = Math.round(ibwDevine(gender, inches) * 10) / 10;
      devineValEl.textContent = kgToStr(dev);

      // BMI card
      const bmi = bmiValue(heightCm, weightKg);
      const bmiRound = Math.round(bmi * 10) / 10;
      const cat = bmiCategoryAsiaPacific(bmiRound);

      bmiTitleEl.textContent = `BMI untuk ${gender === "male" ? "Laki-laki" : "Perempuan"}`;
      bmiMetaEl.textContent = `Tinggi ${heightCm} cm • Berat ${fmt(weightKg, 1)} kg`;
      bmiStatusEl.textContent = `${fmt(bmiRound, 1)} • ${cat.label}`;
      bmiMsgEl.textContent = cat.msg;

      bmiBubbleEl.textContent = fmt(bmiRound, 1);
      bmiMarkerEl.style.left = `${bmiToPercent(bmiRound)}%`;

      // Age warning
      const showWarn = Number.isFinite(age) && age > 0 && age < 18;
      warnEl.style.display = showWarn ? "inline-flex" : "none";
    }

    function resetAll(){
      ageEl.value = "";
      genderEl.value = "male";
      heightEl.value = "";
      weightEl.value = "";

      bmiRangeBigEl.textContent = "—";
      miniMetaEl.textContent = "—";
      devineValEl.textContent = "—";

      bmiTitleEl.textContent = "BMI";
      bmiMetaEl.textContent = "—";
      bmiStatusEl.textContent = "—";
      bmiMsgEl.textContent = "—";
      bmiBubbleEl.textContent = "—";
      bmiMarkerEl.style.left = "50%";

      if (weightErrEl) weightErrEl.textContent = "";
      warnEl.style.display = "none";
      clearError(heightEl);
      clearError(weightEl);
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      calculate();
    });

    $("btnReset").addEventListener("click", resetAll);
  </script>
</body>
</html>
