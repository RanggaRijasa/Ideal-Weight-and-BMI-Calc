<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MSC Ideal Body Weight Calculator</title>

  <!-- Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* ✅ FULL BLACK BACKGROUND (no gradient) */
      --bg:#000000;

      /* ✅ Dark glass cards */
      --card: rgba(17,17,17,.82);
      --text:#F8FAFC;
      --muted:#B0B7C3;

      /* Accent */
      --accent:#FACC15;   /* yellow */
      --accent2:#DC2626;  /* red */

      --shadow: 0 20px 60px rgba(0,0,0,.55);
      --radius: 24px;
      --line: rgba(255,255,255,.10);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: var(--bg); /* ✅ black */
      min-height:100vh;
      padding:32px 16px;
    }

    .wrap{ max-width: 980px; margin: 0 auto; }
    .header{ margin-bottom:18px; }

    .title{
      font-size: clamp(24px, 3vw, 34px);
      line-height: 1.15;
      margin:0;
      letter-spacing: -0.5px;
      font-weight: 900;
      text-transform: uppercase;
      color: var(--accent);
    }

    .header h1:not(.title){
      font-size: clamp(18px, 2.2vw, 22px);
      margin: 8px 0 0 0;
      color:#fff;
      font-weight: 800;
      letter-spacing: -.2px;
    }

    .subtitle{
      margin:10px 0 0 0;
      color:var(--muted);
      max-width: 80ch;
      font-size: 14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 18px;
      align-items: start;
    }
    @media (max-width: 920px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: var(--card);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-head{ padding: 18px 18px 0 18px; }
    .card-title{
      margin:0;
      font-size: 16px;
      font-weight: 900;
      letter-spacing: -.2px;
      color:#fff;
    }
    .card-note{
      margin:6px 0 0 0;
      color: var(--muted);
      font-size: 13px;
    }
    .card-body{ padding: 16px 18px 18px 18px; }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 520px){ .row{ grid-template-columns: 1fr; } }

    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom: 12px; }
    label{ font-size: 13px; color: var(--muted); }

    input, select{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      color: var(--text);
      outline: none;
      font-size: 15px;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    input::placeholder{ color: rgba(176,183,195,.65); }
    input:focus, select:focus{
      border-color: rgba(250,204,21,.65);
      box-shadow: 0 0 0 4px rgba(250,204,21,.18);
    }

    .unitbox{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items:center;
    }
    .unit{
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      color: rgba(176,183,195,.85);
      font-size: 14px;
      min-width: 62px;
      text-align:center;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    button{
      border:0;
      padding: 12px 14px;
      border-radius: 16px;
      font-weight: 900;
      cursor:pointer;
      font-size: 14px;
      transition: transform .06s ease, filter .12s ease, opacity .12s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    button:active{ transform: translateY(1px); }
    button[disabled]{ opacity:.55; cursor:not-allowed; }

    .primary{
      color: white;
      background: linear-gradient(135deg, var(--accent2), #991B1B);
      box-shadow: 0 14px 34px rgba(220,38,38,.25);
    }
    .ghost{
      background: transparent;
      border: 1px solid rgba(250,204,21,.55);
      color: var(--accent);
    }

    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    .error{
      font-size: 12px;
      color: #FCA5A5;
      margin-top: -2px;
      min-height: 16px;
    }

    .results{ padding: 18px; display:flex; flex-direction:column; gap:14px; }

    .big{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding: 16px 16px;
      border-radius: 20px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
    }
    .big .k{
      font-size: 12px;
      color: var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .big .v{
      font-size: clamp(22px, 3vw, 30px);
      font-weight: 900;
      letter-spacing:-.4px;
      color:#fff;
    }

    .item{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      padding: 14px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,.28);
      border: 1px solid var(--line);
    }
    .item .left{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .item .name{ font-weight: 900; font-size: 14px; line-height:1.2; color:#fff; }
    .item .desc{ font-size: 12px; color: var(--muted); line-height:1.35; }
    .item .val{ font-weight: 900; font-size: 14px; white-space: nowrap; color: var(--accent); }

    /* BMI card */
    .bmi-card{
      padding: 16px 16px;
      border-radius: 20px;
      background: rgba(0,0,0,.28);
      border: 1px solid var(--line);
    }
    .bmi-top{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 8px;
    }
    .bmi-status{
      font-size: 22px;
      font-weight: 900;
      letter-spacing: -0.3px;
      margin: 2px 0 10px 0;
      color:#fff;
    }
    .bmi-bar{
      position: relative;
      height: 14px;
      border-radius: 999px;
      overflow:hidden;
      background: #111;
      border: 1px solid rgba(255,255,255,.12);
    }
    .seg{ height:100%; float:left; }

    /* ✅ BAR COLORS KEEP SAME (red-green-yellow-red) */
    .s1{ width: 23%; background: #ff4d4f; }
    .s2{ width: 15%; background: #91c55b; }
    .s3{ width: 7%;  background: #ffd166; }
    .s4{ width: 55%; background: #ff4d4f; }

    .marker{
      position:absolute;
      top: -18px;
      transform: translateX(-50%);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      pointer-events:none;
    }
    .marker .bubble{
      background:#111827;
      color:white;
      font-weight:900;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      line-height:1;
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
    }
    .marker .tri{
      width:0;height:0;
      border-left:7px solid transparent;
      border-right:7px solid transparent;
      border-top:10px solid #111827;
    }

    .bmi-msg{
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.45;
    }
    .bmi-foot{
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.28);
      border:1px solid var(--line);
      color: var(--muted);
      font-size: 12px;
    }
    .warn{
      background: rgba(220,38,38,.12);
      border-color: rgba(220,38,38,.28);
      color: #FCA5A5;
    }
    .mono{ font-variant-numeric: tabular-nums; }

    .footer{
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1 class="title">MSC Body Transformation</h1>
      <h1>Kalkulator Berat Badan Ideal</h1>
      <p class="subtitle">
        Hitung <b>berat badan ideal</b> dari tinggi badan & gender.
        Isi <b>berat badan</b> untuk melihat <b>berat yang perlu diturunkan/naikkan</b> dan menghitung <b>BMI (Asia-Pasifik)</b>.
      </p>
    </div>

    <div class="grid">
      <!-- INPUT -->
      <section class="card" aria-label="Input">
        <div class="card-head">
          <p class="card-title">Masukkan data</p>
          <p class="card-note">Klik tombol <b>Hitung</b> untuk menampilkan hasil. Lalu bisa <b>Download PDF</b>.</p>
        </div>

        <div class="card-body">
          <form id="calcForm" novalidate>
            <div class="row">
              <div class="field">
                <label for="age">Umur</label>
                <input id="age" type="text" inputmode="numeric" autocomplete="off" placeholder="Contoh: 21" />
              </div>

              <div class="field">
                <label for="gender">Gender</label>
                <select id="gender">
                  <option value="male">Pria</option>
                  <option value="female">Wanita</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="heightCm">Tinggi badan</label>
                <div class="unitbox">
                  <input id="heightCm" type="text" inputmode="numeric" autocomplete="off" placeholder="Contoh: 170" />
                  <div class="unit">cm</div>
                </div>
              </div>

              <div class="field">
                <label for="weightKg">Berat badan</label>
                <div class="unitbox">
                  <input id="weightKg" type="text" inputmode="decimal" autocomplete="off" placeholder="Contoh: 75 atau 60.8" />
                  <div class="unit">kg</div>
                </div>
                <div class="error" id="weightErr" aria-live="polite"></div>
              </div>
            </div>

            <div class="actions">
              <button class="primary" id="btnCalc" type="submit">✨ Hitung</button>
              <button class="ghost" id="btnReset" type="button">Reset</button>
            </div>

            <div class="hint">
              Tinggi & umur hanya angka. Berat boleh desimal dengan <b>titik</b> (contoh: <b>60.8</b>).
            </div>
          </form>
        </div>
      </section>

      <!-- RESULTS -->
      <section class="card" aria-label="Hasil">
        <div class="results">
          <div class="big">
            <div class="k">
              <span>Berat ideal (Broca Index)</span>
              <span id="miniMeta" class="mono">—</span>
            </div>
            <div class="v mono" id="idealBig">—</div>
          </div>

          <div class="item" id="deltaCard">
            <div class="left">
              <div class="name" id="deltaTitle">Berat yang perlu diturunkan/naikkan</div>
              <div class="desc" id="deltaDesc">Isi berat badan untuk melihat target.</div>
            </div>
            <div class="val mono" id="deltaVal">—</div>
          </div>

          <!-- BMI CARD -->
          <div class="bmi-card" id="bmiCard">
            <div class="bmi-top">
              <span id="bmiTitle">BMI (Asia-Pasifik)</span>
              <span class="mono" id="bmiMeta">—</span>
            </div>

            <div class="bmi-status" id="bmiStatus">—</div>

            <div class="bmi-bar" aria-label="BMI Bar">
              <div class="seg s1"></div>
              <div class="seg s2"></div>
              <div class="seg s3"></div>
              <div class="seg s4"></div>

              <div class="marker" id="bmiMarker" style="left:50%;">
                <div class="bubble mono" id="bmiValueBubble">—</div>
                <div class="tri"></div>
              </div>
            </div>

            <div class="bmi-msg" id="bmiMsg">Isi berat badan untuk menampilkan BMI.</div>
            <div class="bmi-foot">
              Cutoff (Asia-Pasifik): <b>Normal</b> 18.5–22.9 • <b>Kelebihan BB</b> 23.0–24.9 • <b>Obesitas</b> ≥ 25.
            </div>
          </div>

          <div class="actions" style="padding:0 2px;">
            <button class="ghost" id="btnPdf" type="button" disabled>⬇️ Download PDF</button>
          </div>

          <div id="ageWarning" class="badge warn" style="display:none;">
            ⚠️ Untuk usia <b>&lt; 18</b>, interpretasi BMI biasanya berbeda (pakai kurva pertumbuhan).
          </div>

          <div class="footer">
            Catatan: Broca Index adalah estimasi sederhana. BMI juga indikator screening, bukan diagnosis—komposisi tubuh bisa membuat hasil “ideal” berbeda.
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- jsPDF (client-side PDF download) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const $ = (id) => document.getElementById(id);

    // DOT decimal formatter (no comma)
    function fmt(n, decimals = 1){
      if (!Number.isFinite(n)) return "—";
      const s = n.toFixed(decimals); // dot decimal
      return s.replace(/\.0+$/,"").replace(/(\.\d*[1-9])0+$/,"$1");
    }
    const kgToStr = (kg) => `${fmt(kg, 1)} kg`;
    const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

    // Digits only for integer inputs
    function digitsOnly(el){
      el.addEventListener("input", () => {
        const before = el.value;
        const after = before.replace(/\D+/g, "");
        if (before !== after) el.value = after;
        el.setCustomValidity("");
      });
    }

    // Decimal input for weight: allow digits + ONE dot, max 2 decimals; comma converted to dot
    function decimalDotOnly(el){
      el.addEventListener("input", () => {
        let v = el.value;
        v = v.replace(/,/g, ".");
        v = v.replace(/[^\d.]/g, "");
        const parts = v.split(".");
        if (parts.length > 2) v = parts[0] + "." + parts.slice(1).join("");
        const [a, b] = v.split(".");
        if (b !== undefined) v = a + "." + b.slice(0, 2);
        el.value = v;

        el.setCustomValidity("");
        const err = $("weightErr");
        if (err) err.textContent = "";
      });
    }

    // Broca (simple):
    // Men: (height - 100)
    // Women: (height - 100) * 0.9
    function brocaIdealKg(gender, heightCm){
      const base = heightCm - 100;
      if (gender === "female") return base * 0.9;
      return base;
    }

    // BMI: kg / (m^2)
    function bmiValue(heightCm, weightKg){
      const h = heightCm / 100;
      return weightKg / (h * h);
    }

    // Asia-Pacific categories:
    function bmiCategoryAsiaPacific(bmi){
      if (bmi < 18.5) return { label: "Kurus", msg: "Fokus tingkatkan asupan bergizi dan pola hidup sehat." };
      if (bmi < 23)   return { label: "Normal", msg: "Bagus! Pertahankan pola makan & aktivitas rutin." };
      if (bmi < 25)   return { label: "Kelebihan BB", msg: "Mulai rapikan pola makan dan tambah aktivitas harian." };
      if (bmi < 30)   return { label: "Obesitas", msg: "Utamakan hidup sehat dan perhatikan konsumsi harian." };
      return            { label: "Obesitas (Kelas II)", msg: "Pertimbangkan program terarah dan konsultasi tenaga kesehatan." };
    }

    // Marker position: map BMI 12..40 to 0..100 (visual only)
    function bmiToPercent(bmi){
      const min = 12, max = 40;
      const p = ((bmi - min) / (max - min)) * 100;
      return clamp(p, 0, 100);
    }

    const form = $("calcForm");
    const ageEl = $("age");
    const genderEl = $("gender");
    const heightEl = $("heightCm");
    const weightEl = $("weightKg");
    const weightErrEl = $("weightErr");

    digitsOnly(ageEl);
    digitsOnly(heightEl);
    decimalDotOnly(weightEl);

    // Results elements
    const idealBigEl = $("idealBig");
    const miniMetaEl = $("miniMeta");
    const warnEl = $("ageWarning");
    const btnPdf = $("btnPdf");

    // Delta UI
    const deltaTitleEl = $("deltaTitle");
    const deltaDescEl = $("deltaDesc");
    const deltaValEl = $("deltaVal");

    // BMI UI
    const bmiTitleEl = $("bmiTitle");
    const bmiMetaEl = $("bmiMeta");
    const bmiStatusEl = $("bmiStatus");
    const bmiMsgEl = $("bmiMsg");
    const bmiMarkerEl = $("bmiMarker");
    const bmiBubbleEl = $("bmiValueBubble");

    let lastResult = null;

    function setError(el, msg){
      el.setCustomValidity(msg);
      el.reportValidity();
    }
    function clearError(el){ el.setCustomValidity(""); }

    function readInt(el){
      const v = el.value.trim();
      if (!v) return NaN;
      const n = Number.parseInt(v, 10);
      return Number.isFinite(n) ? n : NaN;
    }

    function readWeightOptional(el){
      const raw = el.value.trim();
      if (!raw) return { ok:true, empty:true, value: NaN, raw: "" };

      const re = /^\d+(\.\d{1,2})?$/;
      if (!re.test(raw)) return { ok:false, empty:false, value: NaN, raw };

      const n = Number.parseFloat(raw);
      if (!Number.isFinite(n)) return { ok:false, empty:false, value: NaN, raw };
      return { ok:true, empty:false, value: n, raw };
    }

    function validate(){
      const h = readInt(heightEl);
      const wObj = readWeightOptional(weightEl);

      clearError(heightEl);
      clearError(weightEl);
      if (weightErrEl) weightErrEl.textContent = "";

      if (!Number.isFinite(h)) { setError(heightEl, "Masukkan tinggi badan (angka). Contoh: 170"); return null; }
      if (h < 120 || h > 220)  { setError(heightEl, "Tinggi badan harus 120–220 cm."); return null; }

      if (!wObj.ok) {
        const msg = "Berat badan harus angka. Desimal pakai titik (contoh: 60.8).";
        if (weightErrEl) weightErrEl.textContent = msg;
        setError(weightEl, msg);
        return null;
      }

      if (!wObj.empty) {
        if (wObj.value < 20 || wObj.value > 300) {
          const msg = "Berat badan harus 20–300 kg.";
          if (weightErrEl) weightErrEl.textContent = msg;
          setError(weightEl, msg);
          return null;
        }
      }

      return { heightCm: h, weightKg: wObj.empty ? null : wObj.value };
    }

    function setBmiEmpty(heightCm, gender){
      bmiTitleEl.textContent = "BMI (Asia-Pasifik)";
      bmiMetaEl.textContent = `${heightCm} cm • ${gender === "male" ? "Pria" : "Wanita"} • Berat: —`;
      bmiStatusEl.textContent = "—";
      bmiBubbleEl.textContent = "—";
      bmiMarkerEl.style.left = "50%";
      bmiMsgEl.textContent = "Isi berat badan untuk menampilkan BMI.";
    }

    function setDeltaEmpty(){
      deltaTitleEl.textContent = "Berat yang perlu diturunkan/naikkan";
      deltaValEl.textContent = "—";
      deltaDescEl.textContent = "Isi berat badan untuk melihat target.";
    }

    function calculate(){
      const gender = genderEl.value;
      const age = readInt(ageEl);

      const v = validate();
      if (!v) return;

      const { heightCm, weightKg } = v;
      const ideal = brocaIdealKg(gender, heightCm);

      miniMetaEl.textContent = `${heightCm} cm • ${gender === "male" ? "Pria" : "Wanita"}`;
      idealBigEl.textContent = kgToStr(ideal);

      // Delta
      if (weightKg == null) {
        setDeltaEmpty();
      } else {
        const change = ideal - weightKg;
        const rounded = Math.round(change * 10) / 10;
        const abs = Math.abs(rounded);

        if (abs < 0.05) {
          deltaTitleEl.textContent = "Target berat";
          deltaValEl.textContent = "0 kg";
          deltaDescEl.textContent = "Berat kamu sudah sangat dekat dengan estimasi ideal.";
        } else if (rounded < 0) {
          deltaTitleEl.textContent = "Berat yang harus diturunkan";
          deltaValEl.textContent = `-${kgToStr(abs)}`;
          deltaDescEl.textContent = "Agar mendekati estimasi ideal, kamu perlu menurunkan berat.";
        } else {
          deltaTitleEl.textContent = "Berat yang harus dinaikkan";
          deltaValEl.textContent = `+${kgToStr(abs)}`;
          deltaDescEl.textContent = "Agar mendekati estimasi ideal, kamu perlu menaikkan berat.";
        }
      }

      // BMI
      if (weightKg == null) {
        setBmiEmpty(heightCm, gender);
      } else {
        const bmi = bmiValue(heightCm, weightKg);
        const bmiRound = Math.round(bmi * 10) / 10;
        const cat = bmiCategoryAsiaPacific(bmiRound);

        bmiTitleEl.textContent = `BMI (Asia-Pasifik)`;
        bmiMetaEl.textContent = `Tinggi ${heightCm} cm • Berat ${fmt(weightKg, 1)} kg`;
        bmiStatusEl.textContent = `${fmt(bmiRound, 1)} • ${cat.label}`;
        bmiMsgEl.textContent = cat.msg;

        bmiBubbleEl.textContent = fmt(bmiRound, 1);
        bmiMarkerEl.style.left = `${bmiToPercent(bmiRound)}%`;
      }

      // Age warning
      const showWarn = Number.isFinite(age) && age > 0 && age < 18;
      warnEl.style.display = showWarn ? "inline-flex" : "none";

      lastResult = {
        age: Number.isFinite(age) && age > 0 ? age : null,
        gender: gender === "male" ? "Pria" : "Wanita",
        heightCm,
        weightKg,
        idealKg: ideal,
        targetChangeKg: weightKg == null ? null : (ideal - weightKg),
        bmi: weightKg == null ? null : (Math.round(bmiValue(heightCm, weightKg) * 10) / 10),
        bmiCat: weightKg == null ? null : bmiCategoryAsiaPacific(Math.round(bmiValue(heightCm, weightKg) * 10) / 10).label,
        createdAt: new Date()
      };
      btnPdf.disabled = false;
    }

    function resetAll(){
      ageEl.value = "";
      genderEl.value = "male";
      heightEl.value = "";
      weightEl.value = "";

      miniMetaEl.textContent = "—";
      idealBigEl.textContent = "—";

      setDeltaEmpty();

      bmiTitleEl.textContent = "BMI (Asia-Pasifik)";
      bmiMetaEl.textContent = "—";
      bmiStatusEl.textContent = "—";
      bmiMsgEl.textContent = "Isi berat badan untuk menampilkan BMI.";
      bmiBubbleEl.textContent = "—";
      bmiMarkerEl.style.left = "50%";

      warnEl.style.display = "none";
      if (weightErrEl) weightErrEl.textContent = "";
      clearError(heightEl);
      clearError(weightEl);

      lastResult = null;
      btnPdf.disabled = true;
    }

    function pad2(n){ return String(n).padStart(2,"0"); }
    function formatDateTime(d){
      const yyyy = d.getFullYear();
      const mm = pad2(d.getMonth()+1);
      const dd = pad2(d.getDate());
      const hh = pad2(d.getHours());
      const mi = pad2(d.getMinutes());
      return `${yyyy}-${mm}-${dd} ${hh}:${mi}`;
    }

    function downloadPdf(){
      if (!lastResult) return;

      const { jsPDF } = window.jspdf || {};
      if (!jsPDF) {
        alert("jsPDF belum termuat. Pastikan koneksi internet / CDN bisa diakses.");
        return;
      }

      const doc = new jsPDF({ unit: "mm", format: "a4" });

      const marginX = 14;
      let y = 16;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(16);
      doc.text("MSC Body Transformation - Report", marginX, y);

      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);
      y += 7;
      doc.text(`Dibuat: ${formatDateTime(lastResult.createdAt)}`, marginX, y);

      y += 10;
      doc.setFont("helvetica", "bold");
      doc.text("Data Input", marginX, y);

      doc.setFont("helvetica", "normal");
      y += 7;
      doc.text(`Gender: ${lastResult.gender}`, marginX, y);
      y += 6;
      doc.text(`Tinggi badan: ${lastResult.heightCm} cm`, marginX, y);
      y += 6;
      doc.text(`Umur: ${lastResult.age == null ? "-" : lastResult.age + " tahun"}`, marginX, y);
      y += 6;
      doc.text(`Berat badan: ${lastResult.weightKg == null ? "-" : fmt(lastResult.weightKg, 1) + " kg"}`, marginX, y);

      y += 10;
      doc.setFont("helvetica", "bold");
      doc.text("Hasil Broca", marginX, y);

      doc.setFont("helvetica", "normal");
      y += 7;
      doc.text(`Berat ideal (Broca): ${fmt(lastResult.idealKg, 1)} kg`, marginX, y);

      y += 6;
      if (lastResult.targetChangeKg == null) {
        doc.text("Target perubahan berat: - (berat badan tidak diisi)", marginX, y);
      } else {
        const change = Math.round(lastResult.targetChangeKg * 10) / 10;
        const abs = Math.abs(change);
        const sign = change > 0 ? "+" : change < 0 ? "-" : "";
        const label = change < 0 ? "Berat yang harus diturunkan" : change > 0 ? "Berat yang harus dinaikkan" : "Target berat";
        doc.text(`${label}: ${sign}${fmt(abs, 1)} kg`, marginX, y);
      }

      y += 10;
      doc.setFont("helvetica", "bold");
      doc.text("Hasil BMI (Asia-Pasifik)", marginX, y);

      doc.setFont("helvetica", "normal");
      y += 7;
      if (lastResult.bmi == null) {
        doc.text("BMI: - (berat badan tidak diisi)", marginX, y);
      } else {
        doc.text(`BMI: ${fmt(lastResult.bmi, 1)} (${lastResult.bmiCat})`, marginX, y);
        y += 6;
        doc.text("Cutoff: Normal 18.5–22.9 | Kelebihan BB 23.0–24.9 | Obesitas ≥ 25", marginX, y);
      }

      y += 12;
      doc.setFont("helvetica", "italic");
      doc.setFontSize(10);
      doc.text(
        "Catatan: Broca Index adalah estimasi sederhana. BMI adalah indikator screening, bukan diagnosis. Konsultasikan ke tenaga kesehatan untuk rekomendasi personal.",
        marginX, y,
        { maxWidth: 180 }
      );

      const filename = `msc_report_${lastResult.heightCm}cm_${lastResult.gender.toLowerCase()}_${formatDateTime(lastResult.createdAt).replace(/[: ]/g,"-")}.pdf`;
      doc.save(filename);
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      calculate();
    });

    $("btnReset").addEventListener("click", resetAll);
    $("btnPdf").addEventListener("click", downloadPdf);

    // init
    setDeltaEmpty();
  </script>
</body>
</html>
